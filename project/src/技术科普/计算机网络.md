---
date: 2024-07-08
title: 计算机网络
category:
  - 网络
tag:
  - http
---

::: tip http2与http1区别?
:::

HTTP/2 是对 HTTP/1.x 协议的重大升级，旨在提高网络性能和效率。以下是 HTTP/2 相对于 HTTP/1 的一些关键区别和改进：

### 1. 协议基础

- **HTTP/1.x**: 基于纯文本的协议，使用新行符分隔的文本消息进行通信。
- **HTTP/2**: 基于二进制的协议，使用二进制帧传输数据，更高效地解析和传输数据。

### 2. 连接管理

- **HTTP/1.x**:
  - 每个请求/响应对通常需要一个单独的TCP连接（HTTP/1.0）。
  - HTTP/1.1 引入了连接保持（Keep-Alive），允许在同一个TCP连接上复用多个请求，但在同一时刻只能处理一个请求（串行化处理）。
  
- **HTTP/2**:
  - 单个TCP连接上可以处理多个并发的请求/响应对。
  - 使用流的概念，每个请求/响应对在一个单独的流中，流之间可以独立并行处理。

### 3. 多路复用

- **HTTP/1.x**: 在一个连接上，只有一个请求/响应对可以被处理（头部阻塞问题），需要等待当前请求完成后，才能开始下一个请求。
- **HTTP/2**: 允许多个请求/响应对在同一连接上的多个流中并发传输，不同的流可以独立处理，不会相互阻塞。

### 4. 头部压缩

- **HTTP/1.x**: HTTP头部是以纯文本格式传输的，每个请求都需要发送完整的头部信息，导致冗余和带宽浪费。
- **HTTP/2**: 使用 HPACK 算法对头部进行压缩，减少了传输数据量。头部信息仅在第一次请求时完整传输，后续请求只需发送差异部分。

### 5. 服务器推送

- **HTTP/1.x**: 客户端必须明确请求每个资源，服务器只能响应客户端的请求。
- **HTTP/2**: 支持服务器推送功能，服务器可以在客户端请求之前主动发送资源，这有助于减少延迟和提升性能。例如，当客户端请求HTML页面时，服务器可以主动推送相关的CSS和JavaScript文件。

### 6. 优先级和流控制

- **HTTP/1.x**: 没有内建的优先级控制机制，所有请求被平等对待。
- **HTTP/2**: 支持流的优先级，客户端可以指定不同流的优先级，允许更重要的请求先行处理。同时，HTTP/2 提供流量控制机制，确保没有流会独占带宽。

### 7. 加密和安全

- **HTTP/1.x**: 加密是可选的（通过HTTP或HTTPS），但非加密的HTTP请求仍然普遍存在。
- **HTTP/2**: 大多数实现强制要求使用加密（通过HTTPS），尽管协议本身不强制这一点。现代浏览器和服务器在实际应用中通常要求 HTTP/2 使用 TLS。

### 8. 协议扩展性

- **HTTP/1.x**: 由于是文本协议，扩展和添加新功能变得复杂。
- **HTTP/2**: 作为二进制协议，HTTP/2 更容易扩展，添加新功能可以通过新帧类型和更复杂的协议操作来实现，而不影响现有的功能。

### 9. 性能改进

- **HTTP/1.x**: 多个小的请求可能会因为串行化处理导致较高的延迟和低效的带宽利用。
- **HTTP/2**: 通过多路复用、头部压缩和服务器推送等功能，HTTP/2 显著降低了延迟，改善了带宽利用，提升了整体性能。

### 总结

| 特性          | HTTP/1.x                         | HTTP/2                           |
|--------------|---------------------------------|---------------------------------|
| 协议类型      | 基于纯文本                        | 基于二进制                      |
| 连接管理      | 每个请求通常需要一个TCP连接        | 单个连接处理多个并发请求        |
| 多路复用      | 不支持（有头部阻塞问题）           | 支持                           |
| 头部压缩      | 不支持                           | 使用HPACK算法进行压缩           |
| 服务器推送    | 不支持                           | 支持                           |
| 优先级和流控制 | 不支持                           | 支持                           |
| 加密和安全    | 可选（但非强制）                  | 大多数实现要求加密（HTTPS）    |
| 协议扩展性    | 扩展复杂                         | 更容易扩展                     |
| 性能          | 受限于串行化处理和头部阻塞         | 显著提升（多路复用、压缩、推送）|

HTTP/2 带来了显著的改进和优化，使得网络应用能够更高效地传输数据，提升了用户体验和网络性能。



## 查看系统中已有的veth设备对或确认已创建的veth设备对，可以使用以下几种方法：

### 使用 `ip` 命令
`ip` 命令是查看和管理网络设备的主要工具：

1. **列出所有网络接口**：
   ```sh
   ip link show
   ```
   该命令会列出系统中所有的网络接口，包括veth设备对。

2. **过滤veth设备**：
   ```sh
   ip link show | grep veth
   ```
   通过`grep`过滤出veth设备。

### 使用 `ifconfig` 命令
`ifconfig`命令也可以用于查看网络接口：
```sh
ifconfig
```
同样，可以使用`grep`过滤出veth设备：
```sh
ifconfig | grep veth
```

### 查看具体veth设备对的详细信息
可以使用以下命令查看某个veth设备对的详细信息：
```sh
ip link show veth0
```

### 示例
假设创建了一个veth设备对：
```sh
ip link add veth0 type veth peer name veth1
```
然后，可以使用以下命令查看：
```sh
ip link show | grep veth
```
输出可能类似于：
```
10: veth0@veth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
11: veth1@veth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
```
这表明`veth0`和`veth1`是一对互相连接的虚拟以太网设备。

### 检查命名空间中的veth设备
如果将veth设备移动到不同的命名空间，可以使用以下命令查看特定命名空间中的网络接口：
```sh
ip netns exec ns1 ip link show

ip netns exec ns1 ip link show
1: lo: <LOOPBACK> mtu 65536 qdisc noop state DOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
28: veth1@if29: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000
    link/ether 52:7e:e0:b6:47:d2 brd ff:ff:ff:ff:ff:ff link-netnsid 0

ip netns exec ns1 ip a
1: lo: <LOOPBACK> mtu 65536 qdisc noop state DOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
28: veth1@if29: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 52:7e:e0:b6:47:d2 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 192.168.1.2/24 scope global veth1
       valid_lft forever preferred_lft forever
    inet6 fe80::507e:e0ff:feb6:47d2/64 scope link
       valid_lft forever preferred_lft forever    
```
假设`veth1`被移动到命名空间`ns1`，可以在`ns1`命名空间中看到它。

通过这些命令，可以方便地查看和管理系统中的veth设备对。


## VLAN 与VXLAN

VLAN（Virtual Local Area Network）和VXLAN（Virtual Extensible LAN）是两种用于网络分段和虚拟化的技术，它们各自有不同的应用场景和特点。以下是对它们的解析：

### VLAN（Virtual Local Area Network）
VLAN是一种用于在同一物理网络上创建多个逻辑网络的技术。它的主要特点和用途如下：

1. **网络分段**：通过VLAN，可以将一个物理网络分割成多个逻辑网络，使得不同VLAN之间的通信受到限制，从而提高网络的安全性和性能。

2. **标记帧**：VLAN使用IEEE 802.1Q标准，在以太网帧中添加一个4字节的标签，标记帧属于哪个VLAN。

3. **VLAN ID**：每个VLAN都有一个唯一的VLAN ID，范围是1到4094。网络设备根据这个ID来区分不同的VLAN。

4. **配置简单**：VLAN的配置相对简单，只需要在交换机上配置相关的端口或接口即可。

5. **常见用途**：
   - 提高网络安全性，通过分割网络减少广播域。
   - 提高网络性能，通过减少广播流量和冲突域。
   - 提供灵活的网络管理和用户分组。

### VXLAN（Virtual Extensible LAN）
VXLAN是一种用于在大规模数据中心和云环境中创建虚拟网络的技术。它的主要特点和用途如下：

1. **扩展性**：VXLAN使用24位的VNI（VXLAN Network Identifier），理论上支持多达1600万个虚拟网络，大大超过了VLAN的4094个限制。

2. **基于隧道**：VXLAN通过UDP隧道封装，将二层以太网帧封装在三层IP包中，从而可以跨越传统的二层边界在IP网络上传输。

3. **分布式架构**：VXLAN适用于大规模的分布式数据中心环境，支持跨多个物理位置的虚拟机迁移和负载均衡。

4. **网络虚拟化**：VXLAN可以在现有的IP网络基础上创建虚拟网络，使得虚拟机和容器之间的通信更加灵活和高效。

5. **常见用途**：
   - 数据中心和云环境中的大规模虚拟化网络。
   - 跨多个数据中心的虚拟机迁移和高可用性。
   - 支持多租户环境，每个租户可以有独立的虚拟网络。

### 对比
| 特点              | VLAN                                    | VXLAN                                 |
|-----------------|---------------------------------------|---------------------------------------|
| 标识符            | 12位VLAN ID（最多4094个）             | 24位VNI（最多1600万个）                |
| 封装层            | 二层以太网（IEEE 802.1Q）              | 三层IP（UDP隧道封装）                   |
| 应用场景          | 小规模网络、局域网                   | 大规模数据中心、云环境、跨数据中心     |
| 配置复杂度        | 简单                                | 较复杂，需要配置隧道端点（VTEP）        |
| 扩展性            | 有限，最多4094个VLAN                | 高扩展性，支持多达1600万个虚拟网络       |

### 总结
VLAN适用于较小规模的网络分段和隔离，而VXLAN适用于大规模数据中心和云环境中的网络虚拟化和扩展。它们各自有不同的优缺点和应用场景，根据具体需求选择合适的技术可以提高网络的性能、安全性和管理灵活性。


## VXLAN与VTEP

### VXLAN（Virtual Extensible LAN）
VXLAN是一种用于扩展二层网络的技术，特别适合在大型数据中心和云环境中使用。其主要特性包括：

1. **扩展性**：VXLAN使用24位的VNI（VXLAN Network Identifier），支持多达1600万个虚拟网络，远远超过传统VLAN的4094个限制。
2. **隧道封装**：VXLAN通过UDP隧道封装将二层以太网帧封装在三层IP包中，从而可以在三层IP网络上进行传输。这种方式允许二层流量跨越不同的三层网络，使得虚拟机可以在不同的物理位置之间自由迁移。
3. **多租户支持**：VXLAN允许在同一个物理网络基础设施上运行多个独立的虚拟网络，每个虚拟网络可以有自己的VNI，从而支持多租户环境。
4. **弹性和高可用性**：VXLAN可以在现有的IP网络上实现二层网络的扩展和弹性，支持负载均衡和高可用性。

### VTEP（VXLAN Tunnel Endpoint）
VTEP是VXLAN架构中的关键组件，负责VXLAN隧道的端点操作。其主要功能包括：

1. **隧道端点**：VTEP是VXLAN隧道的起点和终点，负责VXLAN包的封装和解封装。每个VTEP有两个主要接口：一个是连接到传统二层网络的接口，另一个是连接到IP网络的接口。
2. **封装和解封装**：当VTEP接收到来自二层网络的以太网帧时，它将帧封装在UDP包中，附加上VNI，然后通过IP网络发送到目标VTEP。目标VTEP解封装UDP包，并将以太网帧发送到其二层网络接口。
3. **VNI映射**：VTEP负责将二层网络中的VLAN ID映射到VXLAN的VNI，从而在VXLAN隧道中维护虚拟网络的隔离和标识。
4. **MAC地址学习**：VTEP通过监听网络流量和ARP（Address Resolution Protocol）请求，学习和维护虚拟网络中MAC地址到VTEP的映射关系。这类似于传统二层交换机的MAC地址表。

### VXLAN 和 VTEP 的工作流程
1. **帧封装**：当主机A发送一个以太网帧给主机B时，该帧首先被发送到本地的VTEP。
2. **VXLAN包封装**：VTEP将该帧封装到一个UDP包中，并附加上对应的VNI。UDP包的源IP和目的IP是VTEP的IP地址。
3. **通过IP网络传输**：封装好的VXLAN包通过三层IP网络传输到目的VTEP。
4. **帧解封装**：目的VTEP接收到VXLAN包后，解封装出原始的以太网帧。
5. **帧传递**：解封装的以太网帧被发送到目标主机B所在的二层网络。

### 总结
VXLAN通过在现有的三层IP网络上创建虚拟二层网络，实现了大规模的数据中心和云环境中的网络虚拟化和扩展。VTEP作为VXLAN架构中的关键组件，负责隧道的端点操作，完成VXLAN包的封装和解封装。VXLAN和VTEP的结合，使得跨越不同物理位置的虚拟机能够像在同一个二层网络中一样进行通信，从而实现了高效、灵活和可扩展的网络架构。